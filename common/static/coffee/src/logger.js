// Generated by CoffeeScript 1.6.1
(function() {

  this.Logger = (function() {
    var listeners;

    function Logger() {}

    listeners = {};

    Logger.log = function(event_type, data, element) {
      var callback, _i, _j, _len, _len1, _ref, _ref1;
      if (element == null) {
        element = null;
      }
      if (event_type in listeners) {
        if (null in listeners[event_type]) {
          _ref = listeners[event_type][null];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            callback = _ref[_i];
            callback(event_type, data, element);
          }
        } else if (element in listeners[event_type]) {
          _ref1 = listeners[event_type][element];
          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
            callback = _ref1[_j];
            callback(event_type, data, element);
          }
        }
      }
      return $.postWithPrefix('/event', {
        event_type: event_type,
        event: JSON.stringify(data),
        page: window.location.href
      });
    };

    Logger.listen = function(event_type, element, callback) {
      if (!(event_type in listeners)) {
        listeners[event_type] = {};
      }
      if (!(element in listeners[event_type])) {
        return listeners[event_type][element] = [callback];
      } else {
        return listeners[event_type][element].push(callback);
      }
    };

    Logger.bind = function() {
      return window.onunload = function() {
        return $.ajaxWithPrefix({
          url: "/event",
          data: {
            event_type: 'page_close',
            event: '',
            page: window.location.href
          },
          async: false
        });
      };
    };

    return Logger;

  })();

  this.log_event = Logger.log;

}).call(this);
